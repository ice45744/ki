<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.T. ก้าวหน้า - แจ้งปัญหา</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body class="min-h-screen flex flex-col pb-24">
    <div class="p-6 pt-12">
        <h1 class="text-xl font-bold flex items-center gap-3">
            <span class="w-8 h-8 bg-orange-50 rounded-xl flex items-center justify-center">
                <i class="fas fa-exclamation-triangle text-orange-500 text-sm"></i>
            </span>
            แจ้งปัญหา
        </h1>
        <p class="text-gray-500 text-xs mt-1">พบปัญหาหรือมีข้อเสนอแนะ แจ้งสภานักเรียนได้ที่นี่</p>

        <div class="mt-6 bg-orange-50 p-4 rounded-2xl border border-orange-100 flex gap-3">
            <i class="fas fa-info-circle text-orange-500 mt-1 text-xs"></i>
            <p class="text-orange-800 text-[10px] leading-relaxed">ข้อมูลของคุณจะถูกเก็บเป็นความลับ สภานักเรียนจะตรวจสอบและดำเนินการแก้ไขปัญหาอย่างเร็วที่สุด</p>
        </div>

        <form id="reportForm" class="mt-8 space-y-5">
            <div class="space-y-1">
                <label class="text-xs font-medium text-gray-700 flex items-center gap-2">
                    <i class="fas fa-map-marker-alt text-gray-400"></i>
                    ประเภทของปัญหา
                </label>
                <select id="issueCategory" required class="w-full p-4 border border-gray-100 rounded-2xl outline-none bg-white text-xs">
                    <option value="">เลือกหมวดหมู่...</option>
                    <option value="อาคารสถานที่">อาคารสถานที่</option>
                    <option value="ความสะอาด">ความสะอาด</option>
                    <option value="ความประพฤติ">ความประพฤติ</option>
                    <option value="อื่นๆ">อื่นๆ</option>
                </select>
            </div>

            <div class="space-y-1">
                <label class="text-xs font-medium text-gray-700 flex items-center gap-2">
                    <i class="fas fa-align-left text-gray-400"></i>
                    หัวข้อปัญหา
                </label>
                <input type="text" id="issueTitle" required class="w-full p-4 border border-gray-100 rounded-2xl outline-none bg-white text-xs" placeholder="สรุปปัญหาในประโยคเดียว...">
            </div>

            <div class="space-y-1">
                <label class="text-xs font-medium text-gray-700 flex items-center gap-2">
                    <i class="fas fa-align-left text-gray-400"></i>
                    รายละเอียด
                </label>
                <textarea id="issueDescription" required class="w-full p-4 border border-gray-100 rounded-2xl outline-none bg-white text-xs min-h-[120px]" placeholder="อธิบายสถานที่และปัญหาที่พบอย่างละเอียด..."></textarea>
            </div>

            <div class="space-y-1">
                <label class="text-xs font-medium text-gray-700 flex items-center gap-2">
                    <i class="fas fa-camera text-gray-400"></i>
                    อัปโหลดรูปภาพประกอบ
                </label>
                <input type="file" id="issueImage" accept="image/*" class="w-full p-4 border border-gray-100 rounded-2xl outline-none bg-white text-xs">
            </div>

            <button type="submit" id="submitBtn" class="w-full bg-blue-600 text-white py-3 rounded-2xl font-bold text-sm shadow-lg shadow-blue-100">ส่งข้อมูล</button>
        </form>
    </div>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 px-6 py-3 flex justify-between items-center z-50 h-20">
        <a href="index.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span>หน้าหลัก</span>
        </a>
        <a href="points.html" class="nav-item">
            <i class="fas fa-tasks"></i>
            <span>กิจกรรม</span>
        </a>
        <a href="announcements.html" class="nav-item">
            <i class="fas fa-bullhorn"></i>
            <span>ประกาศ</span>
        </a>
        <a href="report.html" class="nav-item active">
            <i class="fas fa-exclamation-circle"></i>
            <span>แจ้งปัญหา</span>
        </a>
        <a href="profile.html" class="nav-item">
            <i class="fas fa-user-circle"></i>
            <span>โปรไฟล์</span>
        </a>
    </nav>
    <script src="js/theme.js"></script>
    <script type="module">
        import { reportIssue } from './js/data.js';

        const form = document.getElementById('reportForm');
        const submitBtn = document.getElementById('submitBtn');

        form.onsubmit = async (e) => {
            e.preventDefault();
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> กำลังส่งข้อมูล...';

            const issueData = {
                category: document.getElementById('issueCategory').value,
                title: document.getElementById('issueTitle').value,
                description: document.getElementById('issueDescription').value
            };
            const imageFile = document.getElementById('issueImage').files[0];

            const result = await reportIssue(issueData, imageFile);
            
            if (result.success) {
                alert('ส่งข้อมูลเรียบร้อยแล้ว สภานักเรียนจะรีบดำเนินการตรวจสอบครับ');
                form.reset();
            } else {
                alert('เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง');
            }

            submitBtn.disabled = false;
            submitBtn.textContent = 'ส่งข้อมูล';
        };
    </script>
</body>
</html>